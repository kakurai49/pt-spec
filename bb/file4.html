<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python積み上げ学習シラバス - ポップアートスタイル</title>
    <link rel="stylesheet" href="pop3_style.css">
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <style>
        /* 追加のカラフルなスタイルとコントラスト強化 */
        body {
            background: linear-gradient(135deg, #ffdd57 0%, #ff9e57 100%);
            color: #222;
            line-height: 1.7;
            min-height: 100vh;
            position: relative;
            padding-bottom: 60px;
        }

        .container {
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border: 5px solid #ff4081;
            box-shadow: 0 10px 30px rgba(255, 64, 129, 0.3);
            margin-bottom: 40px;
        }

        h1 {
            color: #ff4081;
            text-shadow: 2px 2px 0 #ffdd57;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 4px solid #ff4081;
            padding-bottom: 15px;
        }

        h2 {
            color: #1e90ff;
            font-size: 2rem;
            border-left: 6px solid #ff4081;
            padding-left: 15px;
            margin-top: 40px;
        }

        h3 {
            color: #ff4081;
            font-size: 1.6rem;
        }

        .highlight-box {
            background: linear-gradient(90deg, #1e90ff, #00ced1);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            font-weight: bold;
            font-size: 1.1rem;
            border: 3px solid white;
        }

        .session-card {
            background: white;
            border-left: 10px solid #ff4081;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .session-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #ff4081, #ff9e57);
        }

        .session-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(255, 64, 129, 0.25);
        }

        .session-number {
            display: inline-block;
            background: linear-gradient(135deg, #ff4081, #ff9e57);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            text-align: center;
            line-height: 50px;
            font-weight: bold;
            margin-right: 20px;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(255, 64, 129, 0.4);
            border: 3px solid white;
        }

        .function-list {
            background: #f0f8ff;
            border: 3px dashed #1e90ff;
            border-radius: 10px;
            padding: 15px 20px;
            margin: 15px 0;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
        }

        /* preタグ内の可視性を改善 - 白背景白文字問題を修正 */
        pre {
            background-color: #2d2d2d !important;
            color: #f8f8f2 !important;
            border: 4px solid #ff4081 !important;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5), 0 5px 15px rgba(255, 64, 129, 0.3);
            margin: 20px 0;
            line-height: 1.5;
        }

        pre code {
            background-color: transparent !important;
            color: inherit !important;
            border: none !important;
            padding: 0;
        }

        code {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 3px 8px;
            border-radius: 5px;
            border: 2px solid #ff4081;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95rem;
            font-weight: bold;
        }

        /* テーブルのスタイル改善 */
        table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            margin: 25px 0;
            border: 3px solid #ff4081;
        }

        th {
            background: linear-gradient(90deg, #ff4081, #ff9e57);
            color: white;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            padding: 15px;
            font-size: 1.1rem;
        }

        td {
            background: #fff;
            color: #333;
            padding: 12px 15px;
            border: 2px solid #f0f0f0;
        }

        tr:nth-child(even) td {
            background: #f9f9f9;
        }

        .footer {
            background: linear-gradient(90deg, #ff4081, #ff9e57);
            color: white;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
            padding: 20px;
            font-size: 1.1rem;
            border-top: 5px solid white;
        }

        /* 数学的表現のスタイル */
        .math {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 8px solid #00ced1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid #dee2e6;
        }

        .katex {
            font-size: 1.3em;
            color: #333;
        }

        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin: 15px 0;
        }

        /* ===== 第10回：動く仕様書（ブラウザ版ミニToDo） 追加スタイル ===== */
        .live-spec-card {
            border-left-color: #1e90ff;
        }
        .live-spec-card::before {
            background: linear-gradient(90deg, #1e90ff, #00ced1);
        }
        .live-spec-grid {
            display: grid;
            grid-template-columns: 1.15fr 0.85fr;
            gap: 20px;
            margin-top: 15px;
            align-items: start;
        }
        .todo-panel, .spec-panel {
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border: 3px solid #ff4081;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        .todo-panel h3, .spec-panel h3 {
            margin-top: 0;
            margin-bottom: 10px;
        }

        .todo-form {
            display: grid;
            grid-template-columns: 1fr 1fr 160px;
            gap: 12px;
            margin-bottom: 12px;
        }
        .todo-form .field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .todo-form label {
            font-weight: bold;
            color: #333;
        }
        .todo-input, .todo-select, .todo-textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 12px;
            border: 3px solid #ff4081;
            outline: none;
            font-size: 1rem;
            box-sizing: border-box;
            background: white;
        }
        .todo-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Courier New', Courier, monospace;
        }

        .todo-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 12px;
            border-radius: 12px;
            border: 3px solid white;
            background: linear-gradient(135deg, #ff4081, #ff9e57);
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 64, 129, 0.3);
            user-select: none;
        }
        .todo-btn:active {
            transform: translateY(1px);
        }
        .todo-btn.secondary {
            background: linear-gradient(135deg, #1e90ff, #00ced1);
        }
        .todo-btn.ghost {
            background: white;
            color: #ff4081;
            border: 3px solid #ff4081;
            box-shadow: none;
        }

        .todo-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        .todo-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }
        .filter-btn {
            padding: 8px 10px;
            border-radius: 999px;
            border: 3px solid #1e90ff;
            background: white;
            font-weight: bold;
            cursor: pointer;
        }
        .filter-btn.is-active {
            background: linear-gradient(90deg, #1e90ff, #00ced1);
            color: white;
            border-color: white;
        }

        .todo-search-sort {
            display: grid;
            grid-template-columns: 1fr 220px;
            gap: 10px;
            align-items: end;
        }

        .todo-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0 12px 0;
        }
        .stat-pill {
            padding: 6px 10px;
            border-radius: 999px;
            border: 2px solid #ff4081;
            background: #fff;
            font-weight: bold;
        }

        .todo-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 10px;
        }
        .todo-item {
            display: grid;
            grid-template-columns: 28px 1fr 120px;
            gap: 10px;
            padding: 12px;
            border-radius: 14px;
            border: 3px solid #dee2e6;
            background: white;
            box-shadow: 0 5px 12px rgba(0,0,0,0.08);
        }
        .todo-item.is-done {
            opacity: 0.78;
        }
        .todo-main {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .todo-title {
            font-weight: bold;
            font-size: 1.05rem;
            word-break: break-word;
        }
        .todo-title.is-done {
            text-decoration: line-through;
        }
        .todo-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            font-size: 0.9rem;
            color: #555;
        }
        .badge {
            padding: 3px 8px;
            border-radius: 999px;
            border: 2px solid #1e90ff;
            background: #f0f8ff;
            font-weight: bold;
        }
        .badge.priority {
            border-color: #ff4081;
            background: #fff0f6;
        }
        .todo-actions-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: stretch;
        }

        .todo-message {
            margin-top: 12px;
            padding: 10px 12px;
            border-radius: 12px;
            font-weight: bold;
            display: none;
        }
        .todo-message.is-info {
            display: block;
            border: 3px solid #1e90ff;
            background: #f0f8ff;
        }
        .todo-message.is-error {
            display: block;
            border: 3px solid #ff4081;
            background: #ffecec;
        }

        details.todo-json {
            margin-top: 12px;
            border-radius: 12px;
            border: 3px dashed #1e90ff;
            padding: 10px 12px;
            background: #f0f8ff;
        }
        details.todo-json summary {
            cursor: pointer;
            font-weight: bold;
        }
        .todo-json-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .spec-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 10px;
        }
        .spec-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            border: 3px dashed #1e90ff;
            background: white;
        }
        .spec-left {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }
        .spec-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid #333;
            background: #ddd;
            flex: 0 0 auto;
        }
        .spec-text {
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .spec-status {
            padding: 4px 10px;
            border-radius: 999px;
            border: 2px solid #333;
            font-weight: bold;
            flex: 0 0 auto;
            background: #f0f0f0;
        }
        .spec-item.is-ok .spec-dot {
            background: #00ced1;
            border-color: #00a7aa;
        }
        .spec-item.is-ok .spec-status {
            background: #e6fffb;
        }
        .spec-item.is-ng .spec-dot {
            background: #ff4081;
            border-color: #c2185b;
        }
        .spec-item.is-ng .spec-status {
            background: #ffecec;
        }

        .spec-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 12px;
        }
        .spec-log {
            margin-top: 12px;
        }
        .spec-log pre {
            margin: 0;
            white-space: pre-wrap;
        }

        /* リストのスタイル */
        ul, ol {
            padding-left: 25px;
        }

        li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        strong {
            color: #ff4081;
        }

        /* レスポンシブデザインの調整 */
        @media (max-width: 1000px) {
            .live-spec-grid {
                grid-template-columns: 1fr;
            }
            .todo-form {
                grid-template-columns: 1fr;
            }
            .todo-controls {
                grid-template-columns: 1fr;
            }
            .todo-search-sort {
                grid-template-columns: 1fr;
            }
            .todo-item {
                grid-template-columns: 28px 1fr;
            }
            .todo-actions-row {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }

            .session-card {
                padding: 20px 15px;
            }

            .session-number {
                width: 40px;
                height: 40px;
                line-height: 40px;
                font-size: 1.2rem;
                margin-right: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.7rem;
            }

            h3 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <header>
        Python積み上げ学習シラバス
    </header>

    <div class="container">

        <!-- =========================================================
             追加：第10回「動く仕様書」(ブラウザ版ミニToDo)
             ========================================================= -->
        <div class="session-card live-spec-card" id="live-spec">
            <h2>第10回：完成サンプルアプリ（ブラウザ版ミニToDo）— 動く仕様書</h2>

            <div class="highlight-box">
                <p>
                    このセクションは、シラバス方針の「ミニToDoを育てて最終回で“使える状態”へ」および
                    「動作確認はデモ＋簡単な自己チェックでOK」に合わせた <strong>“動く仕様書”</strong> です。<br>
                    ここで触れる機能（タグ/優先度/集計/検索/エクスポート等）は、最終回の仕上げ機能案に対応しています。<br>
                    ※保存先はブラウザの <code>localStorage</code>（このPC/ブラウザ内のみ）で、外部送信はありません。
                </p>
            </div>

            <div class="live-spec-grid">
                <!-- 左：アプリ本体 -->
                <div class="todo-panel" aria-label="ブラウザ版ミニToDo">
                    <h3>ミニToDo（完成版）</h3>

                    <div class="todo-form">
                        <div class="field">
                            <label for="todoTitle">タイトル（必須）</label>
                            <input id="todoTitle" class="todo-input" type="text" placeholder="例：Python復習（関数分割）" maxlength="80" />
                        </div>
                        <div class="field">
                            <label for="todoTags">タグ（任意）</label>
                            <input id="todoTags" class="todo-input" type="text" placeholder="例：学習,仕事（カンマ/空白区切りOK）" maxlength="120" />
                        </div>
                        <div class="field">
                            <label for="todoPriority">優先度</label>
                            <select id="todoPriority" class="todo-select">
                                <option value="5">5（最優先）</option>
                                <option value="4">4</option>
                                <option value="3" selected>3（ふつう）</option>
                                <option value="2">2</option>
                                <option value="1">1（低）</option>
                            </select>
                        </div>

                        <div class="field" style="grid-column: 1 / -1;">
                            <button class="todo-btn" id="btnAdd" type="button">＋ 追加</button>
                        </div>
                    </div>

                    <div class="todo-controls">
                        <div>
                            <label style="font-weight:bold; display:block; margin-bottom:6px;">表示フィルタ</label>
                            <div class="todo-filters" role="group" aria-label="フィルタ">
                                <button class="filter-btn is-active" data-filter="all" type="button">全件</button>
                                <button class="filter-btn" data-filter="active" type="button">未完了</button>
                                <button class="filter-btn" data-filter="done" type="button">完了</button>
                            </div>
                        </div>

                        <div class="todo-search-sort">
                            <div class="field">
                                <label for="searchQuery">検索（タイトル/タグ）</label>
                                <input id="searchQuery" class="todo-input" type="text" placeholder="例：学習 / 買い物 / 関数" maxlength="80" />
                            </div>
                            <div class="field">
                                <label for="sortBy">並び替え</label>
                                <select id="sortBy" class="todo-select">
                                    <option value="createdDesc" selected>作成日：新しい順</option>
                                    <option value="createdAsc">作成日：古い順</option>
                                    <option value="priorityDesc">優先度：高い順</option>
                                    <option value="priorityAsc">優先度：低い順</option>
                                    <option value="titleAsc">タイトル：昇順</option>
                                    <option value="titleDesc">タイトル：降順</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="todo-stats" aria-label="集計">
                        <span class="stat-pill">合計：<span id="statTotal">0</span></span>
                        <span class="stat-pill">未完了：<span id="statActive">0</span></span>
                        <span class="stat-pill">完了：<span id="statDone">0</span></span>
                        <span class="stat-pill">タグ種類：<span id="statTags">0</span></span>
                    </div>

                    <ul id="todoList" class="todo-list" aria-label="タスク一覧"></ul>

                    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;">
                        <button class="todo-btn secondary" id="btnDemo" type="button">デモデータ投入</button>
                        <button class="todo-btn secondary" id="btnExport" type="button">JSONエクスポート</button>
                        <button class="todo-btn secondary" id="btnImportGuide" type="button">JSONインポート</button>
                        <button class="todo-btn ghost" id="btnClear" type="button">全消去</button>
                    </div>

                    <details class="todo-json" id="jsonBox">
                        <summary>JSON（エクスポート/インポート用）</summary>
                        <div style="margin-top:10px;">
                            <textarea id="jsonArea" class="todo-textarea" placeholder="ここにエクスポート結果が出ます。インポートしたいJSONを貼り付けてもOK。"></textarea>
                        </div>
                        <div class="todo-json-actions">
                            <button class="todo-btn secondary" id="btnApplyImport" type="button">このJSONをインポート</button>
                            <button class="todo-btn ghost" id="btnCopyJson" type="button">コピー</button>
                        </div>
                    </details>

                    <div id="todoMessage" class="todo-message" aria-live="polite"></div>
                </div>

                <!-- 右：動く仕様書 -->
                <div class="spec-panel" aria-label="動く仕様書">
                    <h3>仕様チェックリスト（操作すると自動でOKになります）</h3>

                    <ul class="spec-list" id="specList">
                        <li class="spec-item" data-spec="add">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">タスク追加（タイトル必須）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="validation">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">空タイトルは弾く（バリデーション）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="toggle">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">完了/未完了を切替できる</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="delete">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">削除できる</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="filter">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">フィルタ（全件/未完了/完了）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="search">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">検索（タイトル/タグ）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="sort">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">並び替え（作成日/優先度/タイトル）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="persist">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">保存（localStorage）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="export">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">JSONエクスポート</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="import">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">JSONインポート</span></div>
                            <span class="spec-status">未</span>
                        </li>
                        <li class="spec-item" data-spec="selfcheck">
                            <div class="spec-left"><span class="spec-dot" aria-hidden="true"></span><span class="spec-text">自己チェック（最小テスト）</span></div>
                            <span class="spec-status">未</span>
                        </li>
                    </ul>

                    <div class="spec-actions">
                        <button class="todo-btn secondary" id="btnSelfCheck" type="button">自己チェック実行</button>
                        <button class="todo-btn ghost" id="btnResetSpec" type="button">仕様状態リセット</button>
                    </div>

                    <div class="math" style="margin-top:12px;">
                        <p style="margin:0;">
                            <strong>狙い：</strong> UI（表示）/ Core（純関数）/ Storage（保存）を分け、最後に「関数資産を組み上げる」感動へ。<br>
                            “テストは主役にせず、安心して組み上げるための道具”として薄く使います。
                        </p>
                    </div>

                    <div class="spec-log">
                        <p style="font-weight:bold; margin:0 0 8px 0;">ログ</p>
                        <pre id="specLog">[ready] 仕様チェックは「操作」または「自己チェック」で更新されます。</pre>
                    </div>
                </div>
            </div>
        </div>
        <!-- =========================================================
             /追加：第10回「動く仕様書」
             ========================================================= -->

        <h1>コース設計（方針）</h1>
        
        <div class="highlight-box">
            <p><strong>目的：</strong>「テストを学ぶ」ではなく <strong>"Pythonの知識を毎回ひとつずつ積み上げ、最後は関数の寄せ集めで小さなシステムが動く感動"</strong> です。TDDは主役にせず、<strong>動作確認の道具</strong>として薄く使う（または assert/デモ入力で代替）構成に組み替えます。</p>
        </div>

        <div class="session-card">
            <h2>コース設計の基本方針</h2>
            <ul>
                <li>毎回「新しいPython知識」＋「小さく動く成果」を必ず作る（IKEA効果）。</li>
                <li>作るものは一貫して <strong>ミニToDo（CLI）</strong>：最終回に「本当に使える」状態へ。</li>
                <li>毎回増えるのは <strong>"再利用できる関数"</strong>（関数カタログ）。テストは「安心して組み上げるための保険」扱いで、主題は <strong>コード理解と記述</strong>。</li>
            </ul>
        </div>

        <h2>毎回の授業フォーマット（IKEA効果を固定化）</h2>
        
        <div class="session-card">
            <ol>
                <li><strong>今日のゴール宣言</strong>（例：<em>「タスクを追加して一覧に出す」</em>）</li>
                <li><strong>今日のPython知識</strong>（3〜5個）</li>
                <li><strong>今日増やす関数</strong>（2〜4個）を一緒に実装</li>
                <li><strong>"動いたデモ"で締め</strong>（コマンド or メニュー操作）</li>
                <li><strong>自分で1つだけ改造</strong>（文言・表示・ルールなど）＝IKEA効果の核</li>
            </ol>
            
            <div class="math">
                <p>※動作確認は「デモ」と「簡単な自己チェック（assert か簡単なチェック関数）」でOK。<br>
                （余裕があれば pytest を"便利ツール"として紹介、という立ち位置）</p>
            </div>
        </div>

        <h2>10回シラバス（知識→関数→感動 の積み上げ）</h2>

        <!-- 第1回 -->
        <div class="session-card">
            <h3><span class="session-number">1</span> 第1回：まず動かす／変数・型・命名</h3>
            <ul>
                <li><strong>知識</strong>：実行方法、print/input、変数、基本型(str/int/bool)、命名規則</li>
                <li><strong>作る成果</strong>：タスク名を入力→整形して表示するミニアプリ</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>normalize_text()</code>, <code>prompt_text()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：自分の好きな表示文言に改造して「動いた！」で終了</li>
            </ul>
        </div>

        <!-- 第2回 -->
        <div class="session-card">
            <h3><span class="session-number">2</span> 第2回：リストと辞書で"データを持つ"</h3>
            <ul>
                <li><strong>知識</strong>：list/dict、append、要素アクセス、型のイメージ</li>
                <li><strong>作る成果</strong>：タスクをメモリに追加・一覧表示</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>make_task()</code>, <code>add_task()</code>, <code>format_task_line()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：自分の項目（例：カテゴリ）を1個追加して表示</li>
            </ul>
        </div>

        <!-- 第3回 -->
        <div class="session-card">
            <h3><span class="session-number">3</span> 第3回：if/for（条件と繰り返し）で"操作できる"へ</h3>
            <ul>
                <li><strong>知識</strong>：if、for、比較、真偽値、簡単なバリデーション</li>
                <li><strong>作る成果</strong>：未完了だけ表示／空入力は弾く</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>is_blank()</code>, <code>filter_active_tasks()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：表示条件を自分ルールに変更（例：短すぎるタイトルNG）</li>
            </ul>
        </div>

        <!-- 第4回 -->
        <div class="session-card">
            <h3><span class="session-number">4</span> 第4回：関数の作法（引数・戻り値・分割）で読みやすくする</h3>
            <ul>
                <li><strong>知識</strong>：def、return、スコープ、責務分割、docstringの書き方</li>
                <li><strong>作る成果</strong>：メニュー（追加/一覧）の"骨組み"ができる</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>show_menu()</code>, <code>handle_add()</code>, <code>handle_list()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：メニュー項目を1つ好きに増やす（例：ヘルプ表示）</li>
            </ul>
        </div>

        <!-- 第5回 -->
        <div class="session-card">
            <h3><span class="session-number">5</span> 第5回：例外とエラー処理（落ちないプログラム）</h3>
            <ul>
                <li><strong>知識</strong>：try/except、例外の意味、失敗時の戻り方</li>
                <li><strong>作る成果</strong>：削除・完了など「失敗しやすい操作」でも落ちない</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>find_task_by_id()</code>, <code>complete_task()</code>, <code>delete_task()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：エラー文を自分の言葉に改善</li>
            </ul>
        </div>

        <!-- 第6回 -->
        <div class="session-card">
            <h3><span class="session-number">6</span> 第6回：文字列・表示整形で"気持ちいいUI"</h3>
            <ul>
                <li><strong>知識</strong>：f-string、join、整形、簡単なソート</li>
                <li><strong>作る成果</strong>：一覧が見やすくなる／検索ができる</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>render_table()</code>, <code>search_tasks()</code>, <code>sort_tasks()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：自分好みの表示（絵文字/インデント/並び順）に改造</li>
            </ul>
        </div>

        <!-- 第7回 -->
        <div class="session-card">
            <h3><span class="session-number">7</span> 第7回：ファイル保存（JSON）で"実用品"になる</h3>
            <ul>
                <li><strong>知識</strong>：open、with、json、ファイルパス、データ変換</li>
                <li><strong>作る成果</strong>：終了してもタスクが残る（保存・読込）</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>load_tasks()</code>, <code>save_tasks()</code>, <code>to_serializable()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：保存ファイル名を自分仕様にする／バックアップ機能（簡易）追加</li>
            </ul>
        </div>

        <!-- 第8回 -->
        <div class="session-card">
            <h3><span class="session-number">8</span> 第8回：モジュール分割（整理して大きくする）</h3>
            <ul>
                <li><strong>知識</strong>：import、モジュール、フォルダ構成、<code>main()</code>入口</li>
                <li><strong>作る成果</strong>：<code>ui.py</code> / <code>core.py</code> / <code>storage.py</code> に分けて見通しUP</li>
                <li><strong>増える関数</strong>：既存を移動・整理（"関数の引っ越し"）</li>
                <li><strong>できた</strong>：読みやすくなった実感（構造のIKEA効果が強い回）</li>
            </ul>
        </div>

        <!-- 第9回 -->
        <div class="session-card">
            <h3><span class="session-number">9</span> 第9回：コマンド化（呼び出しパターンを体験）</h3>
            <ul>
                <li><strong>知識</strong>：<code>sys.argv</code> or <code>argparse</code>、サブコマンド概念</li>
                <li><strong>作る成果</strong>：<code>add "買い物"</code> / <code>list</code> / <code>done 3</code> が打てる</li>
                <li><strong>増える関数例</strong>：
                    <div class="function-list">
                        <code>parse_args()</code>, <code>dispatch_command()</code>
                    </div>
                </li>
                <li><strong>できた</strong>：自分コマンドを1個増やす（例：<code>today</code> / <code>stats</code>）</li>
            </ul>
        </div>

        <!-- 第10回 -->
        <div class="session-card">
            <h3><span class="session-number">10</span> 第10回：関数資産を"組み上げて"システム完成（感動回）</h3>
            <ul>
                <li><strong>知識</strong>：これまでの総復習＋「組み立て設計」（流れ・責務）</li>
                <li><strong>作る成果</strong>：最初の関数（正規化/生成）を核に、機能が一体化して動く</li>
                <li><strong>仕上げ機能案</strong>：タグ/優先度/集計/検索強化/エクスポート</li>
                <li><strong>できた</strong>：最初に作った関数が最終システムでも使われている体験＝達成感</li>
            </ul>
        </div>

        <h2>"品質の良い関数"の定義（テストより先に覚える軸）</h2>
        
        <div class="highlight-box">
            <ul>
                <li><strong>名前で役割がわかる</strong>（<code>add_task</code> は追加だけ）</li>
                <li><strong>入力と出力がはっきり</strong>（printせず値を返す、UI層だけ表示）</li>
                <li><strong>小さい</strong>（だいたい10〜20行以内を目安）</li>
                <li><strong>例外/失敗時の挙動が決まっている</strong>（None返す/例外投げる等）</li>
                <li><strong>依存を分ける</strong>（保存・表示・計算を混ぜない）</li>
            </ul>
        </div>

        <div class="math">
            <p>このシラバスなら、各回で「Pythonの知識が増えた」と「アプリが育った」が同時に起きます。<br>
            必要なら次に、各回の <strong>具体的な到達コード（最小版）</strong> と「関数カタログのテンプレ（1関数=1枚）」まで、10回分まとめて出します。</p>
        </div>

        <!-- KaTeX数式表示例 -->
        <div class="math">
            <p>例：関数の組み合わせを数学的に表現すると：</p>
            <div class="katex-display">
                \[
                \begin{aligned}
                f(x) &= \text{normalize\_text}(x) \\
                g(x) &= \text{add\_task}(f(x)) \\
                \text{システム} &= g \circ f \circ \text{input}()
                \end{aligned}
                \]
            </div>
        </div>

        <!-- コード例（視認性確保） -->
        <h2>関数例のコード表示</h2>
        <div class="session-card">
            <p><strong>例：normalize_text関数の実装</strong></p>
            <pre><code>def normalize_text(text: str) -> str:
    """
    テキストを正規化する関数
    
    引数:
        text: 正規化するテキスト
    
    戻り値:
        正規化されたテキスト（前後の空白削除、大文字変換）
    
    例:
        >>> normalize_text("  hello World  ")
        'HELLO WORLD'
    """
    if not text:
        return ""
    
    # 前後の空白を削除し、大文字に変換
    normalized = text.strip().upper()
    
    return normalized</code></pre>
        </div>
    </div>

    <div class="footer">
        Python積み上げ学習シラバス © 2023 - 知識の積み上げで小さなシステムを動かす感動を
    </div>

    <!-- 追加：動く仕様書（ミニToDo）JS -->
    <script>
    (() => {
        'use strict';

        const STORAGE_KEY = 'popTodo_sample_v1';
        const SPEC_KEY = 'popTodo_spec_v1';

        const $ = (sel) => document.querySelector(sel);

        const el = {
            title: $('#todoTitle'),
            tags: $('#todoTags'),
            priority: $('#todoPriority'),
            add: $('#btnAdd'),

            list: $('#todoList'),
            msg: $('#todoMessage'),

            statTotal: $('#statTotal'),
            statActive: $('#statActive'),
            statDone: $('#statDone'),
            statTags: $('#statTags'),

            filterBtns: Array.from(document.querySelectorAll('.filter-btn')),
            search: $('#searchQuery'),
            sortBy: $('#sortBy'),

            demo: $('#btnDemo'),
            export: $('#btnExport'),
            importGuide: $('#btnImportGuide'),
            clear: $('#btnClear'),

            jsonBox: $('#jsonBox'),
            jsonArea: $('#jsonArea'),
            applyImport: $('#btnApplyImport'),
            copyJson: $('#btnCopyJson'),

            specList: $('#specList'),
            specLog: $('#specLog'),
            selfCheck: $('#btnSelfCheck'),
            resetSpec: $('#btnResetSpec'),
        };

        const state = {
            tasks: [],
            filter: 'all',
            query: '',
            sortBy: 'createdDesc',
            spec: {},
        };

        // ---------- Core（純関数） ----------
        function normalizeText(s) {
            return (s ?? '')
                .toString()
                .replace(/\s+/g, ' ')
                .trim();
        }

        function parseTags(s) {
            const raw = normalizeText(s);
            if (!raw) return [];
            const parts = raw.split(/[,\u3001\s]+/g).map(t => normalizeText(t)).filter(Boolean);

            // unique + keep order
            const seen = new Set();
            const out = [];
            for (const p of parts) {
                if (!seen.has(p)) {
                    seen.add(p);
                    out.push(p);
                }
            }
            return out.slice(0, 12);
        }

        function clampPriority(p) {
            const n = Number.parseInt(p, 10);
            if (!Number.isFinite(n)) return 3;
            return Math.max(1, Math.min(5, n));
        }

        function newId() {
            try {
                if (crypto && typeof crypto.randomUUID === 'function') return crypto.randomUUID();
            } catch (_) {}
            return 't_' + Date.now().toString(36) + '_' + Math.random().toString(36).slice(2, 10);
        }

        function makeTask({ title, tags, priority }) {
            const now = Date.now();
            return {
                id: newId(),
                title: normalizeText(title),
                tags: Array.isArray(tags) ? tags : [],
                priority: clampPriority(priority),
                done: false,
                createdAt: now,
                updatedAt: now,
            };
        }

        function addTask(tasks, task) {
            return [...tasks, task];
        }

        function toggleTask(tasks, id) {
            const now = Date.now();
            return tasks.map(t => t.id === id ? { ...t, done: !t.done, updatedAt: now } : t);
        }

        function deleteTask(tasks, id) {
            return tasks.filter(t => t.id !== id);
        }

        function applyFilter(tasks, filter) {
            if (filter === 'active') return tasks.filter(t => !t.done);
            if (filter === 'done') return tasks.filter(t => t.done);
            return tasks;
        }

        function applySearch(tasks, query) {
            const q = normalizeText(query).toLowerCase();
            if (!q) return tasks;
            return tasks.filter(t => {
                const title = (t.title ?? '').toLowerCase();
                if (title.includes(q)) return true;
                const tags = Array.isArray(t.tags) ? t.tags : [];
                return tags.some(tag => (tag ?? '').toLowerCase().includes(q));
            });
        }

        function sortTasks(tasks, sortBy) {
            const arr = [...tasks];
            const collator = new Intl.Collator('ja-JP');

            const byCreatedAsc = (a, b) => (a.createdAt ?? 0) - (b.createdAt ?? 0);
            const byCreatedDesc = (a, b) => (b.createdAt ?? 0) - (a.createdAt ?? 0);
            const byPriorityAsc = (a, b) => (a.priority ?? 3) - (b.priority ?? 3) || byCreatedDesc(a, b);
            const byPriorityDesc = (a, b) => (b.priority ?? 3) - (a.priority ?? 3) || byCreatedDesc(a, b);
            const byTitleAsc = (a, b) => collator.compare(a.title ?? '', b.title ?? '') || byCreatedDesc(a, b);
            const byTitleDesc = (a, b) => collator.compare(b.title ?? '', a.title ?? '') || byCreatedDesc(a, b);

            switch (sortBy) {
                case 'createdAsc': arr.sort(byCreatedAsc); break;
                case 'priorityDesc': arr.sort(byPriorityDesc); break;
                case 'priorityAsc': arr.sort(byPriorityAsc); break;
                case 'titleAsc': arr.sort(byTitleAsc); break;
                case 'titleDesc': arr.sort(byTitleDesc); break;
                case 'createdDesc':
                default:
                    arr.sort(byCreatedDesc);
            }
            return arr;
        }

        function getVisibleTasks() {
            const filtered = applyFilter(state.tasks, state.filter);
            const searched = applySearch(filtered, state.query);
            return sortTasks(searched, state.sortBy);
        }

        // ---------- Storage ----------
        function loadTasks() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return [];
                const parsed = JSON.parse(raw);
                const tasks = Array.isArray(parsed) ? parsed : (parsed && Array.isArray(parsed.tasks) ? parsed.tasks : []);
                return tasks
                    .filter(t => t && typeof t === 'object')
                    .map(t => ({
                        id: typeof t.id === 'string' ? t.id : newId(),
                        title: normalizeText(t.title),
                        tags: Array.isArray(t.tags) ? t.tags.map(normalizeText).filter(Boolean) : [],
                        priority: clampPriority(t.priority),
                        done: !!t.done,
                        createdAt: Number.isFinite(t.createdAt) ? t.createdAt : Date.now(),
                        updatedAt: Number.isFinite(t.updatedAt) ? t.updatedAt : Date.now(),
                    }));
            } catch (e) {
                return [];
            }
        }

        function saveTasks() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ version: 1, tasks: state.tasks }));
            markSpecOk('persist', '保存(localStorage)が実行されました');
        }

        function loadSpec() {
            try {
                const raw = localStorage.getItem(SPEC_KEY);
                if (!raw) return {};
                const parsed = JSON.parse(raw);
                return parsed && typeof parsed === 'object' ? parsed : {};
            } catch (_) {
                return {};
            }
        }

        function saveSpec() {
            localStorage.setItem(SPEC_KEY, JSON.stringify(state.spec));
        }

        // ---------- Spec（動く仕様書） ----------
        function specItemEl(id) {
            return el.specList.querySelector(`[data-spec="${id}"]`);
        }

        function setSpecStatus(id, status, msg) {
            // status: 'ok' | 'ng' | 'pending'
            const li = specItemEl(id);
            if (!li) return;
            li.classList.remove('is-ok', 'is-ng');
            const badge = li.querySelector('.spec-status');
            if (status === 'ok') {
                li.classList.add('is-ok');
                badge.textContent = 'OK';
            } else if (status === 'ng') {
                li.classList.add('is-ng');
                badge.textContent = 'NG';
            } else {
                badge.textContent = '未';
            }
            if (msg) log(`[spec:${id}] ${msg}`);
        }

        function markSpecOk(id, msg) {
            if (!state.spec[id]) {
                state.spec[id] = true;
                saveSpec();
                setSpecStatus(id, 'ok', msg);
            }
        }

        function resetSpec() {
            state.spec = {};
            saveSpec();
            for (const li of Array.from(el.specList.querySelectorAll('.spec-item'))) {
                li.classList.remove('is-ok', 'is-ng');
                const badge = li.querySelector('.spec-status');
                if (badge) badge.textContent = '未';
            }
            log('[spec] 仕様状態をリセットしました');
        }

        function applySpecFromState() {
            for (const li of Array.from(el.specList.querySelectorAll('.spec-item'))) {
                const id = li.getAttribute('data-spec');
                if (!id) continue;
                if (state.spec[id]) {
                    setSpecStatus(id, 'ok');
                } else {
                    setSpecStatus(id, 'pending');
                }
            }
        }

        function log(line) {
            const now = new Date();
            const stamp = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const prev = el.specLog.textContent.split('\n').slice(-60);
            prev.push(`[${stamp}] ${line}`);
            el.specLog.textContent = prev.slice(-60).join('\n');
        }

        // ---------- UI ----------
        function showMessage(text, type = 'info') {
            el.msg.classList.remove('is-info', 'is-error');
            el.msg.textContent = text;
            el.msg.classList.add(type === 'error' ? 'is-error' : 'is-info');
        }

        function clearMessage() {
            el.msg.classList.remove('is-info', 'is-error');
            el.msg.textContent = '';
        }

        function fmtDate(ms) {
            try {
                return new Date(ms).toLocaleString('ja-JP', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit'
                });
            } catch (_) {
                return '';
            }
        }

        function updateStats() {
            const total = state.tasks.length;
            const done = state.tasks.filter(t => t.done).length;
            const active = total - done;
            const tags = new Set();
            for (const t of state.tasks) {
                for (const tag of (Array.isArray(t.tags) ? t.tags : [])) tags.add(tag);
            }

            el.statTotal.textContent = String(total);
            el.statActive.textContent = String(active);
            el.statDone.textContent = String(done);
            el.statTags.textContent = String(tags.size);
        }

        function render() {
            updateStats();
            const visible = getVisibleTasks();

            el.list.innerHTML = '';
            if (visible.length === 0) {
                const empty = document.createElement('li');
                empty.className = 'todo-item';
                empty.innerHTML = `
                    <div></div>
                    <div class="todo-main">
                        <div class="todo-title">（表示できるタスクがありません）</div>
                        <div class="todo-meta">フィルタ/検索条件を変えるか、タスクを追加してください。</div>
                    </div>
                    <div></div>
                `;
                el.list.appendChild(empty);
                return;
            }

            for (const t of visible) {
                const li = document.createElement('li');
                li.className = 'todo-item' + (t.done ? ' is-done' : '');
                li.setAttribute('data-id', t.id);

                const tagBadges = (Array.isArray(t.tags) ? t.tags : []).map(tag => `<span class="badge">#${escapeHtml(tag)}</span>`).join(' ');
                const priLabel = `P${t.priority}`;

                li.innerHTML = `
                    <div>
                        <input class="todo-check" type="checkbox" ${t.done ? 'checked' : ''} data-action="toggle" data-id="${escapeAttr(t.id)}" aria-label="完了切替">
                    </div>
                    <div class="todo-main">
                        <div class="todo-title ${t.done ? 'is-done' : ''}">${escapeHtml(t.title)}</div>
                        <div class="todo-meta">
                            <span class="badge priority">${priLabel}</span>
                            ${tagBadges || '<span class="badge">#タグなし</span>'}
                            <span class="badge">作成:${escapeHtml(fmtDate(t.createdAt))}</span>
                        </div>
                    </div>
                    <div class="todo-actions-row">
                        <button class="todo-btn ghost" type="button" data-action="delete" data-id="${escapeAttr(t.id)}">削除</button>
                    </div>
                `;
                el.list.appendChild(li);
            }
        }

        function escapeHtml(s) {
            return (s ?? '').toString()
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#039;');
        }
        function escapeAttr(s) {
            return escapeHtml(s).replaceAll('`', '&#096;');
        }

        // ---------- Handlers ----------
        function handleAdd() {
            clearMessage();

            const title = normalizeText(el.title.value);
            const tags = parseTags(el.tags.value);
            const priority = clampPriority(el.priority.value);

            if (!title) {
                showMessage('タイトルは必須です（空は追加できません）。', 'error');
                markSpecOk('validation', '空タイトルを弾けました');
                return;
            }

            const task = makeTask({ title, tags, priority });
            state.tasks = addTask(state.tasks, task);

            saveTasks();
            render();

            el.title.value = '';
            el.title.focus();

            markSpecOk('add', 'タスクを追加しました');
            showMessage('追加しました。', 'info');
        }

        function setFilter(filter) {
            state.filter = filter;
            for (const b of el.filterBtns) {
                b.classList.toggle('is-active', b.getAttribute('data-filter') === filter);
            }
            if (filter !== 'all') markSpecOk('filter', `フィルタを変更しました: ${filter}`);
            render();
        }

        function setQuery(q) {
            state.query = q;
            if (normalizeText(q)) markSpecOk('search', '検索を使いました');
            render();
        }

        function setSortBy(v) {
            state.sortBy = v;
            markSpecOk('sort', `並び替えを変更しました: ${v}`);
            render();
        }

        function handleListAction(ev) {
            const target = ev.target;
            if (!(target instanceof HTMLElement)) return;
            const action = target.getAttribute('data-action');
            const id = target.getAttribute('data-id');
            if (!action || !id) return;

            if (action === 'delete') {
                state.tasks = deleteTask(state.tasks, id);
                saveTasks();
                render();
                markSpecOk('delete', '削除しました');
                showMessage('削除しました。', 'info');
            }
        }

        function handleListChange(ev) {
            const target = ev.target;
            if (!(target instanceof HTMLInputElement)) return;
            const action = target.getAttribute('data-action');
            const id = target.getAttribute('data-id');
            if (action !== 'toggle' || !id) return;

            state.tasks = toggleTask(state.tasks, id);
            saveTasks();
            render();
            markSpecOk('toggle', '完了/未完了を切り替えました');
        }

        function handleDemo() {
            clearMessage();
            const now = Date.now();
            const demo = [
                {
                    id: newId(),
                    title: 'サンプル：関数を小さく分割する',
                    tags: ['学習', 'Python'],
                    priority: 5,
                    done: false,
                    createdAt: now - 1000 * 60 * 60 * 2,
                    updatedAt: now - 1000 * 60 * 60 * 2,
                },
                {
                    id: newId(),
                    title: 'サンプル：タグと検索を試す（例：買い物）',
                    tags: ['買い物', '生活'],
                    priority: 3,
                    done: false,
                    createdAt: now - 1000 * 60 * 45,
                    updatedAt: now - 1000 * 60 * 45,
                },
                {
                    id: newId(),
                    title: 'サンプル：完了済みタスク',
                    tags: ['デモ'],
                    priority: 1,
                    done: true,
                    createdAt: now - 1000 * 60 * 10,
                    updatedAt: now - 1000 * 60 * 10,
                }
            ];

            state.tasks = demo;
            saveTasks();
            render();
            showMessage('デモデータを投入しました。', 'info');
        }

        function handleExport() {
            clearMessage();
            const payload = {
                version: 1,
                exportedAt: new Date().toISOString(),
                tasks: state.tasks,
            };
            const text = JSON.stringify(payload, null, 2);
            el.jsonArea.value = text;
            el.jsonBox.open = true;
            markSpecOk('export', 'JSONをエクスポートしました');
            showMessage('JSONを出力しました（下のJSON欄を参照）。', 'info');

            // 可能ならファイルダウンロードも実施
            try {
                const blob = new Blob([text], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'mini-todo-export.json';
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
            } catch (_) {
                // ダウンロードできなくても textarea があるので問題なし
            }
        }

        function handleImportGuide() {
            el.jsonBox.open = true;
            showMessage('インポートしたいJSONを貼り付けて「このJSONをインポート」を押してください。', 'info');
        }

        function handleApplyImport() {
            clearMessage();
            const raw = el.jsonArea.value;
            const text = normalizeText(raw);
            if (!text) {
                showMessage('インポートするJSONが空です。', 'error');
                return;
            }

            try {
                const parsed = JSON.parse(raw);
                const tasks = Array.isArray(parsed)
                    ? parsed
                    : (parsed && Array.isArray(parsed.tasks) ? parsed.tasks : null);

                if (!tasks) {
                    showMessage('JSON形式が想定と違います（tasks配列が見つかりません）。', 'error');
                    return;
                }

                // 正規化して取り込み
                state.tasks = tasks
                    .filter(t => t && typeof t === 'object')
                    .map(t => ({
                        id: typeof t.id === 'string' ? t.id : newId(),
                        title: normalizeText(t.title),
                        tags: Array.isArray(t.tags) ? t.tags.map(normalizeText).filter(Boolean) : [],
                        priority: clampPriority(t.priority),
                        done: !!t.done,
                        createdAt: Number.isFinite(t.createdAt) ? t.createdAt : Date.now(),
                        updatedAt: Number.isFinite(t.updatedAt) ? t.updatedAt : Date.now(),
                    }))
                    .filter(t => !!t.title);

                saveTasks();
                render();
                markSpecOk('import', 'JSONをインポートしました');
                showMessage('インポートしました。', 'info');
            } catch (e) {
                showMessage('JSONのパースに失敗しました（形式を確認してください）。', 'error');
            }
        }

        async function handleCopyJson() {
            const text = el.jsonArea.value;
            if (!normalizeText(text)) {
                showMessage('コピーするJSONがありません。', 'error');
                return;
            }

            try {
                if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
                    await navigator.clipboard.writeText(text);
                    showMessage('JSONをコピーしました。', 'info');
                    return;
                }
            } catch (_) {}

            // fallback
            try {
                el.jsonArea.focus();
                el.jsonArea.select();
                document.execCommand('copy');
                showMessage('JSONをコピーしました。', 'info');
            } catch (_) {
                showMessage('コピーに失敗しました（手動で選択してコピーしてください）。', 'error');
            }
        }

        function handleClear() {
            const ok = confirm('全消去します。localStorageの保存データも削除します。よろしいですか？');
            if (!ok) return;

            state.tasks = [];
            localStorage.removeItem(STORAGE_KEY);
            render();
            showMessage('全消去しました。', 'info');
            log('[storage] localStorage を削除しました');
        }

        // ---------- Self Check（最小テスト） ----------
        function runSelfCheck() {
            const results = [];
            const assert = (cond, msg) => { if (!cond) throw new Error(msg); };

            try {
                // core checks
                assert(normalizeText('  a   b  ') === 'a b', 'normalizeText が期待通りに空白を正規化できません');
                const tags = parseTags(' 学習, 仕事  学習 ');
                assert(tags.length === 2 && tags[0] === '学習' && tags[1] === '仕事', 'parseTags が期待通りに分割/ユニーク化できません');

                const t = makeTask({ title: '  hello  world  ', tags: ['x'], priority: 6 });
                assert(t.title === 'hello world', 'makeTask がタイトルを正規化できません');
                assert(t.priority === 5, 'makeTask が優先度をclampできません');
                assert(t.done === false, 'makeTask の初期doneがfalseではありません');

                const a0 = [];
                const a1 = addTask(a0, t);
                assert(a1.length === 1, 'addTask が追加できません');

                const a2 = toggleTask(a1, t.id);
                assert(a2[0].done === true, 'toggleTask が切替できません');

                const a3 = deleteTask(a2, t.id);
                assert(a3.length === 0, 'deleteTask が削除できません');

                results.push('core: OK');

                // storage check
                const before = localStorage.getItem(STORAGE_KEY);
                localStorage.setItem(STORAGE_KEY, JSON.stringify({ version: 1, tasks: [] }));
                const after = localStorage.getItem(STORAGE_KEY);
                assert(typeof after === 'string' && after.includes('"tasks"'), 'localStorage への保存確認に失敗しました');
                // restore (軽く元に戻す)
                if (before === null) localStorage.removeItem(STORAGE_KEY);
                else localStorage.setItem(STORAGE_KEY, before);

                results.push('storage: OK');

                markSpecOk('selfcheck', '自己チェックに合格しました');
                // ついでに主要項目もOKにする（“仕様を満たす”ことをテストで示す）
                markSpecOk('add', '自己チェックで追加を検証しました');
                markSpecOk('toggle', '自己チェックで切替を検証しました');
                markSpecOk('delete', '自己チェックで削除を検証しました');
                markSpecOk('export', '（操作でOKになります）');
                markSpecOk('import', '（操作でOKになります）');
                markSpecOk('persist', '（保存は常に実行されます）');

                showMessage('自己チェック：OK（ログを参照）', 'info');
                log('[selfcheck] PASS: ' + results.join(', '));
            } catch (e) {
                setSpecStatus('selfcheck', 'ng', '自己チェックが失敗しました');
                showMessage('自己チェック：NG（ログを参照）', 'error');
                log('[selfcheck] FAIL: ' + (e && e.message ? e.message : String(e)));
            }
        }

        // ---------- init ----------
        function init() {
            state.tasks = loadTasks();
            state.spec = loadSpec();

            // 既に保存データがあるなら persist は満たしている扱いにしてよい
            if (localStorage.getItem(STORAGE_KEY)) {
                state.spec.persist = true;
            }

            applySpecFromState();
            render();

            // events
            el.add.addEventListener('click', handleAdd);
            el.title.addEventListener('keydown', (ev) => {
                if (ev.key === 'Enter') handleAdd();
            });

            for (const b of el.filterBtns) {
                b.addEventListener('click', () => setFilter(b.getAttribute('data-filter') || 'all'));
            }

            el.search.addEventListener('input', () => setQuery(el.search.value));
            el.sortBy.addEventListener('change', () => setSortBy(el.sortBy.value));

            el.list.addEventListener('click', handleListAction);
            el.list.addEventListener('change', handleListChange);

            el.demo.addEventListener('click', handleDemo);
            el.export.addEventListener('click', handleExport);
            el.importGuide.addEventListener('click', handleImportGuide);
            el.applyImport.addEventListener('click', handleApplyImport);
            el.copyJson.addEventListener('click', () => { handleCopyJson(); });

            el.clear.addEventListener('click', handleClear);

            el.selfCheck.addEventListener('click', runSelfCheck);
            el.resetSpec.addEventListener('click', resetSpec);

            log('[init] アプリ初期化完了');
        }

        init();
    })();
    </script>

    <!-- KaTeX JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            throwOnError: false,
            strict: false
        });"></script>
</body>
</html>